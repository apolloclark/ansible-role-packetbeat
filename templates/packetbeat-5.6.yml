################### Packetbeat Configuration Example ##########################

# This file contains an overview of various configuration settings. Please consult
# the docs at https://www.elastic.co/guide/en/beats/packetbeat/current/packetbeat-configuration.html
# for more details.

# The Packetbeat shipper works by sniffing the network traffic between your
# application components. It inserts meta-data about each transaction into
# Elasticsearch.

packetbeat:
  ########################### General ########################################
  #
  #
  # https://www.elastic.co/guide/en/beats/packetbeat/current/configuration-general.html
  #

{% if 'name' in packetbeat_combined %}
  # The name of the shipper that publishes the network data. It can be used to group
  # all the transactions sent by a single shipper in the web interface. Default
  # is the hostname.
  name: "{{ packetbeat_combined.name }}"
{% endif %}

{% if 'tags' in packetbeat_combined %}
  # The tags of the shipper are included in their own field with each
  # transaction published.
  tags: "{{ packetbeat_combined.tags }}"
{% endif %}

{% if 'fields' in packetbeat_combined %}
  # Optional fields that you can specify to add additional information to the
  # output.
  fields:
{% for field in packetbeat_combined.fields %}
    {{ field }}
{% endfor %}
{% endif %}

{% if 'fields_under_root' in packetbeat_combined %}
  # If this option is set to true, the custom fields are stored as top-level
  # fields in the output document instead of being grouped under a fields
  # sub-dictionary. If the custom field names conflict with other field names,
  # then the custom fields overwrite the other fields. The default value is false.
  fields_under_root: "{{ packetbeat_combined.fields_under_root }}"
{% endif %}

{% if 'queue_size' in packetbeat_combined %}
  # The internal queue size for single events in the processing pipeline. 
  # The default value is 1000.
  queue_size: {{ packetbeat_combined.queue_size }}
{% endif %}

{% if 'bulk_queue_size' in packetbeat_combined %}
  # (DO NOT TOUCH) The internal queue size for bulk events in the processing
  # pipeline. The default value is 0.
  bulk_queue_size: {{ packetbeat_combined.bulk_queue_size }}
{% endif %}

{% if 'max_procs' in packetbeat_combined and packetbeat_combined.max_procs %}
  # Sets the maximum number of CPUs that can be executing simultaneously. The
  # default is the number of logical CPUs available in the system.
  max_procs: {{ packetbeat_combined.max_procs }}
{% endif %}





  ########################### Interfaces ########################################
  #
  # https://www.elastic.co/guide/en/beats/packetbeat/current/configuration-interfaces.html
  #

  interfaces:
    # Select the network interfaces to sniff the data. You can use the "any"
    # keyword to sniff on all connected interfaces.
    device: "{{ packetbeat_combined.interfaces.device }}"

{% if 'snaplen' in packetbeat_combined.interfaces %}
    # The maximum size of the packets to capture. The default is 65535, which is
    # large enough for almost all networks and interface types. If you sniff on a
    # physical network interface, the optimal setting is the MTU size. On virtual
    # interfaces, however, it’s safer to accept the default value.
    snaplen: {{ packetbeat_combined.interfaces.snaplen }}
{% endif %}

{% if 'type' in packetbeat_combined.interfaces %}
    # Packetbeat supports three sniffer types:
    # - pcap, which uses the libpcap library and works on most platforms, but it’s
    #   not the fastest option.
    # - af_packet, which uses memory-mapped sniffing. This option is faster than
    #   libpcap and doesn’t require a kernel module, but it’s Linux-specific.
    # - pf_ring, which makes use of an ntop.org project. This setting provides
    #   the best sniffing speed, but it requires a kernel module, and it’s Linux-specific.
    # Note
    # The pf_ring option requires re-compilation of Packetbeat and is not
    # officially supported by Elastic at this moment. The default sniffer type is pcap.
    type: "{{ packetbeat_combined.interfaces.type }}"
{% endif %}

{% if 'buffer_size_mb' in packetbeat_combined.interfaces %}
    # The maximum size of the shared memory buffer to use between the kernel and
    # user space. A bigger buffer usually results in lower CPU usage, but consumes
    # more memory. This setting is only available for the af_packet sniffer type.
    # The default is 30 MB.
    buffer_size_mb: {{ packetbeat_combined.interfaces.buffer_size_mb }}
{% endif %}

{% if 'with_vlans' in packetbeat_combined.interfaces %}
    # Packetbeat automatically generates a BPF for capturing only the traffic on
    # ports where it expects to find known protocols. For example, if you have
    # configured port 80 for HTTP and port 3306 for MySQL, Packetbeat generates
    # the following BPF filter: "port 80 or port 3306".
    #
    # However, if the traffic contains VLAN tags, the filter that Packetbeat
    # generates is ineffective because the offset is moved by four bytes. To fix
    # this, you can enable the with_vlans option, which generates a BPF filter
    # that looks like this: "port 80 or port 3306 or (vlan and (port 80 or port 3306))".
    with_vlans: "{{ packetbeat_combined.interfaces.with_vlans }}"
{% endif %}

{% if 'bpf_filter' in packetbeat_combined.interfaces %}
    # Packetbeat automatically generates a BPF for capturing only the traffic on
    # ports where it expects to find known protocols. For example, if you have
    # configured port 80 for HTTP and port 3306 for MySQL, Packetbeat generates
    # the following BPF filter: "port 80 or port 3306".
    bpf_filter: "{{ packetbeat_combined.interfaces.bpf_filter }}"
{% endif %}

{% if 'ignore_outgoing' in packetbeat_combined.interfaces %}
    # If the ignore_outgoing option is enabled, Packetbeat ignores all the
    # transactions initiated from the server running Packetbeat.
    #
    # This is useful when two Packetbeat instances publish the same transactions.
    # Because one Packetbeat sees the transaction in its outgoing queue and the
    # other sees it in its incoming queue, you can end up with duplicate
    # transactions. To remove the duplicates, you can enable the
    # packetbeat.ignore_outgoing option on one of the servers.
    ignore_outgoing: "{{ packetbeat_combined.interfaces.ignore_outgoing }}"
{% endif %}





  ############################# Protocols #######################################
  #
  # https://www.elastic.co/guide/en/beats/packetbeat/current/configuration-protocols.html
  #
{% if 'protocols' in packetbeat_combined %}
  protocols:

{% if 'icmp' in packetbeat_combined.protocols %}
    #
    #------------------------------------ ICMP -----------------------------------
    #
    # https://www.elastic.co/guide/en/beats/packetbeat/current/configuration-protocols.html#_icmp_configuration_options
    icmp:
{% if 'enabled' in packetbeat_combined.protocols.icmp %}
      # The ICMP protocol can be enabled/disabled via this option.
      # The default is true.
      #
      # If enabled Packetbeat will generate the following BPF filter: "icmp or icmp6".
      enabled:  "{{ packetbeat_combined.protocols.icmp.enabled }}"
{% endif %}

{% endif %}



{% if 'dns' in packetbeat_combined.protocols %}
    #
    #------------------------------------- DNS -----------------------------------
    #
    # https://www.elastic.co/guide/en/beats/packetbeat/current/configuration-protocols.html#_dns_configuration_options
    dns:

{% if 'enabled' in packetbeat_combined.protocols.dns %}
      # The enabled setting is a boolean setting to enable or disable protocols
      # without having to comment out configuration sections. If set to false,
      # the protocol is disabled.
      #
      # The default value is true.
      enabled:  "{{ packetbeat_combined.protocols.dns.enabled }}"
{% endif %}

{% if 'ports' in packetbeat_combined.protocols.dns %}
      # Configure the ports where to listen for DNS traffic. You can disable
      # the DNS protocol by commenting out the list of ports.
      ports: {{ packetbeat_combined.protocols.dns.ports }}
{% endif %}

{% if 'send_request' in packetbeat_combined.protocols.dns %}
      # send_request and send_response control whether or not the stringified DNS
      # request and response message are added to the result.
      # Nearly all data about the request/response is available in the dns.*
      # fields, but this can be useful if you need visibility specifically
      # into the request or the response.
      # Default: false
      send_request:  "{{ packetbeat_combined.protocols.dns.send_request }}"
{% endif %}
{% if 'send_response' in packetbeat_combined.protocols.dns %}
      send_response: "{{ packetbeat_combined.protocols.dns.send_response }}"
{% endif %}

{% if 'include_authorities' in packetbeat_combined.protocols.dns %}
      # include_authorities controls whether or not the dns.authorities field
      # (authority resource records) is added to messages.
      # Default: false
      include_authorities: "{{ packetbeat_combined.protocols.dns.include_authorities }}"
{% endif %}

{% if 'include_additionals' in packetbeat_combined.protocols.dns %}
      # include_additionals controls whether or not the dns.additionals field
      # (additional resource records) is added to messages.
      # Default: false
      include_additionals: "{{ packetbeat_combined.protocols.dns.include_additionals }}"
{% endif %}

{% endif %}



{% if 'http' in packetbeat_combined.protocols %}
    #
    #--------------------------------- HTTP --------------------------------------
    #
    # https://www.elastic.co/guide/en/beats/packetbeat/current/configuration-protocols.html#_http_configuration_options
    http:

{% if 'enabled' in packetbeat_combined.protocols.http %}
      # The enabled setting is a boolean setting to enable or disable protocols
      # without having to comment out configuration sections. If set to false,
      # the protocol is disabled.
      #
      # The default value is true.
      enabled:  "{{ packetbeat_combined.protocols.http.enabled }}"
{% endif %}

{% if 'ports' in packetbeat_combined.protocols.http %}
      # Configure the ports where to listen for HTTP traffic. You can disable
      # the HTTP protocol by commenting out the list of ports.
      ports: {{ packetbeat_combined.protocols.http.ports }}
{% endif %}

{% if 'send_request' in packetbeat_combined.protocols.http %}
      # If this option is enabled, the raw message of the request (request field)
      # is sent to Elasticsearch. The default is false. This option is useful
      # when you want to index the whole request. The default value is false.
      #
      # Note that for HTTP, the body is not included by default, only the HTTP headers.
      send_request:  "{{ packetbeat_combined.protocols.http.send_request }}"
{% endif %}

{% if 'send_response' in packetbeat_combined.protocols.http %}
      # If this option is enabled, the raw message of the response (response
      # field) is sent to Elasticsearch. The default is false. This option is
      # useful when you want to index the whole response.
      #
      # Note that for HTTP, the body is not included by default, only the HTTP headers.
      send_response: "{{ packetbeat_combined.protocols.http.send_response }}"
{% endif %}

{% if 'hide_keywords' in packetbeat_combined.protocols.http %}
      # Uncomment the following to hide certain parameters in URL or forms attached
      # to HTTP requests. The names of the parameters are case insensitive.
      # The value of the parameters will be replaced with the 'xxxxx' string.
      # This is generally useful for avoiding storing user passwords or other
      # sensitive information.
      # Only query parameters and top level form parameters are replaced.
      hide_keywords: {{ packetbeat_combined.protocols.http.hide_keywords }}
{% endif %}

{% if 'redact_authorization' in packetbeat_combined.protocols.http %}
      # When this option is enabled, Packetbeat obscures the value of
      # Authorization and Proxy-Authorization HTTP headers, and censors those
      # strings in the response.
      #
      # You should set this option to true for transactions that use Basic
      # Authentication because they may contain the base64 unencrypted username
      # and password.
      redact_authorization: "{{ packetbeat_combined.protocols.http.redact_authorization }}"
{% endif %}

{% if 'send_headers' in packetbeat_combined.protocols.http %}
      # A list of header names to capture and send to Elasticsearch. These headers
      # are placed under the headers dictionary in the resulting JSON.
      send_headers: {{ packetbeat_combined.protocols.http.send_headers }}
{% endif %}

{% if 'send_all_headers' in packetbeat_combined.protocols.http %}
      # Instead of sending a white list of headers to Elasticsearch, you can
      # send all headers by setting this option to true. The default is false.
      send_all_headers: "{{ packetbeat_combined.protocols.http.send_all_headers }}"
{% endif %}

{% if 'include_body_for' in packetbeat_combined.protocols.http %}
      # The list of content types for which Packetbeat exports the full HTTP
      # payload. The HTTP body is available under http.request.body and
      # http.response.body for these Content-Types.
      #
      # In addition, if send_response option is enabled, then the HTTP body is
      # exported together with the HTTP headers under response and if
      # send_request enabled, then request contains the entire HTTP message
      # including the body.
      include_body_for: {{ packetbeat_combined.protocols.http.include_body_for }}
{% endif %}

{% if 'split_cookie' in packetbeat_combined.protocols.http %}
      # If the Cookie or Set-Cookie headers are sent, this option controls
      # whether they are split into individual values.
      # 
      # The default is false.
      split_cookie: "{{ packetbeat_combined.protocols.http.split_cookie }}"
{% endif %}

{% if 'real_ip_header' in packetbeat_combined.protocols.http %}
      # The header field to extract the real IP from. This setting is useful
      # when you want to capture traffic behind a reverse proxy, but you want
      # to get the geo-location information. If this header is present and
      # contains a valid IP addresses, the information is used for the
      # real_ip field.
      real_ip_header: "{{ packetbeat_combined.protocols.http.real_ip_header }}"
{% endif %}

{% if 'max_message_size' in packetbeat_combined.protocols.http %}
      # If an individual HTTP message is larger than this setting (in bytes),
      # it will be trimmed to this size. Unless this value is very small (<1.5K),
      # Packetbeat is able to still correctly follow the transaction and create
      # an event for it. The default is 10485760 (10 MB).
      max_message_size: {{ packetbeat_combined.protocols.http.max_message_size }}
{% endif %}

{% endif %}



{% if 'memcache' in packetbeat_combined.protocols %}
    #
    #------------------------------- Memcache ------------------------------------
    #
    # https://www.elastic.co/guide/en/beats/packetbeat/current/configuration-protocols.html#_memcache_configuration_options
    memcache:
      # Configure the ports where to listen for memcache traffic. You can disable
      # the Memcache protocol by commenting out the list of ports.
      ports: {{ packetbeat_combined.protocols.memcache.ports }}

      # Uncomment the parseunknown option to force the memcache text protocol parser
      # to accept unknown commands.
      # Note: All unknown commands MUST not contain any data parts!
      # Default: false
      parseunknown: "{{ packetbeat_combined.protocols.memcache.parseunknown }}"

      # Update the maxvalue option to store the values - base64 encoded - in the
      # json output.
      # possible values:
      #    maxvalue: -1  # store all values (text based protocol multi-get)
      #    maxvalue: 0   # store no values at all
      #    maxvalue: N   # store up to N values
      # Default: 0
      maxvalues: {{ packetbeat_combined.protocols.memcache.maxvalues }}

      # Use maxbytespervalue to limit the number of bytes to be copied per value element.
      # Note: Values will be base64 encoded, so actual size in json document
      #       will be 4 times maxbytespervalue.
      # Default: unlimited
      maxbytespervalue: {{ packetbeat_combined.protocols.memcache.maxbytespervalue }}

      # UDP transaction timeout in milliseconds.
      # Note: Quiet messages in UDP binary protocol will get response only in error case.
      #       The memcached analyzer will wait for udptransactiontimeout milliseconds
      #       before publishing quiet messages. Non quiet messages or quiet requests with
      #       error response will not have to wait for the timeout.
      # Default: 200
      udptransactiontimeout: {{ packetbeat_combined.protocols.memcache.udptransactiontimeout }}
{% endif %}

{% if 'mysql' in packetbeat_combined.protocols %}
    mysql:
      # Configure the ports where to listen for MySQL traffic. You can disable
      # the MySQL protocol by commenting out the list of ports.
      ports: {{ packetbeat_combined.protocols.mysql.ports }}
{% endif %}

{% if 'pgsql' in packetbeat_combined.protocols %}
    pgsql:
      # Configure the ports where to listen for Pgsql traffic. You can disable
      # the Pgsql protocol by commenting out the list of ports.
      ports: {{ packetbeat_combined.protocols.pgsql.ports }}
{% endif %}

{% if 'redis' in packetbeat_combined.protocols %}
    redis:
      # Configure the ports where to listen for Redis traffic. You can disable
      # the Redis protocol by commenting out the list of ports.
      ports: {{ packetbeat_combined.protocols.redis.ports }}
{% endif %}

{% if 'thrift' in packetbeat_combined.protocols %}
    thrift:
      # Configure the ports where to listen for Thrift-RPC traffic. You can disable
      # the Thrift-RPC protocol by commenting out the list of ports.
      ports: {{ packetbeat_combined.protocols.thrift.ports }}
{% endif %}

{% if 'mongodb' in packetbeat_combined.protocols %}
    mongodb:
      # Configure the ports where to listen for MongoDB traffic. You can disable
      # the MongoDB protocol by commenting out the list of ports.
      ports: {{ packetbeat_combined.protocols.mongodb.ports }}
{% endif %}

{% endif %}





  ############################# Processes #######################################
  #
  # https://www.elastic.co/guide/en/beats/packetbeat/current/configuration-processes.html
  #
{% if 'procs' in packetbeat_combined %}
  # Configure the processes to be monitored and how to find them. If a process is
  # monitored then Packetbeat attempts to use it's name to fill in the `proc` and
  # `client_proc` fields.
  # The processes can be found by searching their command line by a given string.
  #
  # Process matching is optional and can be enabled by uncommenting the following
  # lines.
  #
  procs:
{% if 'enabled' in packetbeat_combined.procs %}
    enabled: {{ packetbeat_combined.procs.enabled }}
{% endif %}
    monitored:
{% for program in packetbeat_combined.procs.monitored %}
      - process: {{ program.process }}
        cmdline_grep: {{ program.cmdline_grep }}
{% endfor %}
{% endif %}





############################# Output ##########################################
#
# Configure what outputs to use when sending the data collected by the beat.
# Multiple outputs may be used.
#
output:



{% if 'elasticsearch' in packetbeat_combined.output %}
  #
  #------------------------- Elasticsearch output -----------------------------
  #
  # https://www.elastic.co/guide/en/beats/filebeat/current/elasticsearch-output.html
  elasticsearch:

{% if 'enabled' in packetbeat_combined.output.elasticsearch %}
    # The enabled config is a boolean setting to enable or disable the output.
    # If set to false, the output is disabled.
    #
    # The default value is true.
    enabled: "{{ packetbeat_combined.output.elasticsearch.enabled }}"
{% endif %}

{% if 'hosts' in packetbeat_combined.output.elasticsearch %}
    # The list of Elasticsearch nodes to connect to. The events are distributed
    # to these nodes in round robin order. If one node becomes unreachable, the
    # event is automatically sent to another node. Each Elasticsearch node can
    # be defined as a URL or IP:PORT. For example: http://192.15.3.2,
    # https://es.found.io:9230 or 192.24.3.2:9300. If no port is specified,
    # 9200 is used.
    hosts: {{ packetbeat_combined.output.elasticsearch.hosts | to_nice_json }}
{% endif %}

{% if 'compression_level' in packetbeat_combined.output.elasticsearch %}
    # The gzip compression level. Setting this value to 0 disables compression.
    # The compression level must be in the range of 1 (best speed) to 9 (best
    # compression).
    #
    # Increasing the compression level will reduce the network usage but will
    # increase the cpu usage.
    #
    # The default value is 0.
    compression_level: {{ packetbeat_combined.output.elasticsearch.compression_level }}
{% endif %}

{% if 'worker' in packetbeat_combined.output.elasticsearch %}
    # The number of workers per configured host publishing events to
    # Elasticsearch. This is best used with load balancing mode enabled.
    # Example: If you have 2 hosts and 3 workers, in total 6 workers are
    # started (3 for each host).
    worker: {{ packetbeat_combined.output.elasticsearch.worker }}
{% endif %}

{% if 'username' in packetbeat_combined.output.elasticsearch %}
    # The basic authentication username for connecting to Elasticsearch.
    username: "{{ packetbeat_combined.output.elasticsearch.username }}"
{% endif %}

{% if 'password' in packetbeat_combined.output.elasticsearch %}
    # The basic authentication password for connecting to Elasticsearch.
    password: "{{ packetbeat_combined.output.elasticsearch.password }}"
{% endif %}

{% if 'parameters' in packetbeat_combined.output.elasticsearch %}
    # Dictionary of HTTP parameters to pass within the url with index operations.
    parameters: {{ packetbeat_combined.output.elasticsearch.parameters }}
{% endif %}

{% if 'protocol' in packetbeat_combined.output.elasticsearch %}
    # The name of the protocol Elasticsearch is reachable on. The options
    # are: http or https. The default is http. However, if you specify a URL
    # for hosts, the value of protocol is overridden by whatever scheme you
    # specify in the URL.
    protocol: "{{ packetbeat_combined.output.elasticsearch.protocol }}"
{% endif %}

{% if 'path' in packetbeat_combined.output.elasticsearch %}
    # An HTTP path prefix that is prepended to the HTTP API calls. This is
    # useful for the cases where Elasticsearch listens behind an HTTP reverse
    # proxy that exports the API under a custom prefix.
    path: "{{ packetbeat_combined.output.elasticsearch.path }}"
{% endif %}

{% if 'headers' in packetbeat_combined.output.elasticsearch %}
    # Custom HTTP headers to add to each request created by the Elasticsearch
    # output. It is generally possible to specify multiple header values
    # for the same header name by separating them with a comma.
    headers: {{ packetbeat_combined.output.elasticsearch.headers }}
{% endif %}

{% if 'proxy_url' in packetbeat_combined.output.elasticsearch %}
    # The URL of the proxy to use when connecting to the Elasticsearch servers.
    # The value may be either a complete URL or a "host[:port]", in which case
    # the "http" scheme is assumed. If a value is not specified through the
    # configuration file then proxy environment variables are used. See the
    # golang documentation for more information about the environment variables.
    proxy_url: "{{ packetbeat_combined.output.elasticsearch.proxy_url }}"
{% endif %}

{% if 'index' in packetbeat_combined.output.elasticsearch %}
    # The index name to write events to. The default is "filebeat-%{+yyyy.MM.dd}"
    # (for example, "filebeat-2015.04.26").
    index: "{{ packetbeat_combined.output.elasticsearch.index }}"
{% endif %}

{% if 'indices' in packetbeat_combined.output.elasticsearch %}
    # Array of index selector rules supporting conditionals, format string based
    # field access and name mappings. The first rule matching will be used
    # to set the index for the event to be published. If indices is missing
    # or no rule matches, the index field will be used.
    indices: {{ packetbeat_combined.output.elasticsearch.indices }}
{% endif %}

{% if 'pipeline' in packetbeat_combined.output.elasticsearch %}
    # A format string value that specifies the ingest node pipeline to write events to.
    pipeline: "{{ packetbeat_combined.output.elasticsearch.pipeline }}"
{% endif %}

{% if 'pipelines' in packetbeat_combined.output.elasticsearch %}
    # Similar to the indices array, this is an array of pipeline selector
    # configurations supporting conditionals, format string based field access
    # and name mappings. The first rule matching will be used to set the
    # pipeline for the event to be published. If pipelines is missing or no
    # rule matches, the pipeline field will be used.
    pipelines: {{ packetbeat_combined.output.elasticsearch.pipelines }}
{% endif %}

{% if 'template' in packetbeat_combined.output.elasticsearch %}
    # The index template to use for setting mappings in Elasticsearch. By
    # default, template loading is enabled.
    template:

{% if 'enabled' in packetbeat_combined.output.elasticsearch.template %}
      # Set to false to disable template loading. If set this to false, you
      # must load the template manually.s
      enabled: "{{ packetbeat_combined.output.elasticsearch.template.enabled }}"
{% endif %}

{% if 'name' in packetbeat_combined.output.elasticsearch.template %}
      # The name of the template. The default is filebeat.
      name: "{{ packetbeat_combined.output.elasticsearch.template.name }}"
{% endif %}

{% if 'path' in packetbeat_combined.output.elasticsearch.template %}
      # The path to the template file. The default is filebeat.template.json.
      # If a relative path is set, it is considered relative to the config
      # path. See the Directory Layout section for details.
      path: "{{ packetbeat_combined.output.elasticsearch.template.path }}"
{% endif %}

{% if 'overwrite' in packetbeat_combined.output.elasticsearch.template %}
      # A boolean that specifies whether to overwrite the existing template.
      # The default is false.
      overwrite: "{{ packetbeat_combined.output.elasticsearch.template.overwrite }}"
{% endif %}
{% endif %}

{% if 'max_retries' in packetbeat_combined.output.elasticsearch %}
    # The number of times to retry publishing an event after a publishing
    # failure. After the specified number of retries, the events are typically
    # dropped. Some Beats, such as Filebeat, ignore the max_retries setting
    # and retry until all events are published.
    #
    # Set max_retries to a value less than 0 to retry until all events are
    # published.
    #
    # The default is 3.
    max_retries: {{ packetbeat_combined.output.elasticsearch.max_retries }}
{% endif %}

{% if 'bulk_max_size' in packetbeat_combined.output.elasticsearch %}
    # The maximum number of events to bulk in a single Elasticsearch bulk API
    # index request. The default is 50.
    #
    # If the Beat sends single events, the events are collected into batches.
    # If the Beat publishes a large batch of events (larger than the value
    # specified by bulk_max_size), the batch is split.
    #
    # Specifying a larger batch size can improve performance by lowering the
    # overhead of sending events. However big batch sizes can also increase
    # processing times, which might result in API errors, killed connections,
    # timed-out publishing requests, and, ultimately, lower throughput.
    #
    # Setting bulk_max_size to values less than or equal to 0 disables buffering
    # in libbeat. When buffering is disabled, Beats that publish single events
    # (such as Packetbeat) send each event directly to Elasticsearch. Beats
    # that publish data in batches (such as Filebeat) send events in batches
    # based on the spooler size.
    bulk_max_size: {{ packetbeat_combined.output.elasticsearch.bulk_max_size }}
{% endif %}

{% if 'timeout' in packetbeat_combined.output.elasticsearch %}
    # The http request timeout in seconds for the Elasticsearch request.
    # The default is 90.
    timeout: {{ packetbeat_combined.output.elasticsearch.timeout }}
{% endif %}

{% if 'flush_interval' in packetbeat_combined.output.elasticsearch %}
    # The number of seconds to wait for new events between two bulk API index
    # requests. If bulk_max_size is reached before this interval expires,
    # additional bulk index requests are made.
    flush_interval: {{ packetbeat_combined.output.elasticsearch.flush_interval }}
{% endif %}

{% if 'ssl' in packetbeat_combined.output.elasticsearch %}
    # https://www.elastic.co/guide/en/beats/filebeat/current/configuration-output-ssl.html
    # ssl:
      # certificate_authorities: ["/etc/pki/root/ca.pem"]
      # certificate: "/etc/pki/client/cert.pem"
      # key: "/etc/pki/client/cert.key"
{% endif %}

{% endif %}



{% if 'logstash' in packetbeat_combined.output %}
  #
  #------------------------- Logstash output -----------------------------
  #
  # https://www.elastic.co/guide/en/beats/filebeat/current/logstash-output.html
  logstash:

{% if 'enabled' in packetbeat_combined.output.logstash %}
    # The enabled config is a boolean setting to enable or disable the output.
    # If set to false, the output is disabled.
    #
    # The default value is true.
    enabled: "{{ packetbeat_combined.output.logstash.enabled }}"
{% endif %}

    # The list of known Logstash servers to connect to. If load balancing is
    # disabled, but mutliple hosts are configured, one host is selected randomly
    # (there is no precedence). If one host becomes unreachable, another one
    # is selected randomly.
    #
    # All entries in this list can contain a port number. If no port number is
    # given, the value specified for port is used as the default port number.
    hosts: {{ packetbeat_combined.output.logstash.hosts }}

{% if 'compression_level' in packetbeat_combined.output.logstash %}
    # The gzip compression level. Setting this value to 0 disables compression.
    # The compression level must be in the range of 1 (best speed) to 9 (best
    # compression).
    #
    # Increasing the compression level will reduce the network usage but will
    # increase the cpu usage.
    #
    # The default value is 3.
    compression_level: {{ packetbeat_combined.output.logstash.compression_level }}
{% endif %}

{% if 'worker' in packetbeat_combined.output.logstash %}
    # The number of workers per configured host publishing events to Logstash.
    # This is best used with load balancing mode enabled. Example: If you have
    # 2 hosts and 3 workers, in total 6 workers are started (3 for each host).
    worker: {{ packetbeat_combined.output.logstash.worker }}
{% endif %}

{% if 'loadbalance' in packetbeat_combined.output.logstash %}
    # If set to true and multiple Logstash hosts are configured, the output
    # plugin load balances published events onto all Logstash hosts. If set to
    # false, the output plugin sends all events to only one host (determined
    # at random) and will switch to another host if the selected one becomes
    # unresponsive.
    #
    # The default value is false.
    loadbalance: "{{ packetbeat_combined.output.logstash.loadbalance }}"
{% endif %}

{% if 'pipelining' in packetbeat_combined.output.logstash %}
    # Configures number of batches to be send asynchronously to logstash while
    # waiting for ACK from logstash. Output only becomes blocking once number
    # of pipelining batches have been written. Pipelining is disabled if a
    # values of 0 is configured.
    #
    # The default value is 0.
    pipelining: {{ packetbeat_combined.output.logstash.pipelining }}
{% endif %}

{% if 'proxy_url' in packetbeat_combined.output.logstash %}
    # The URL of the SOCKS5 proxy to use when connecting to the Logstash servers.
    # The value must be a URL with a scheme of socks5://. The protocol used
    # to communicate to Logstash is not based on HTTP so a web-proxy cannot
    # be used.
    #
    # If the SOCKS5 proxy server requires client authentication, then a
    # username and password can be embedded in the URL as shown in the example.
    #
    # When using a proxy, hostnames are resolved on the proxy server instead of
    # on the client. You can change this behavior by setting the
    # proxy_use_local_resolver option.
    proxy_url: "{{ packetbeat_combined.output.logstash.proxy_url }}"
{% endif %}

{% if 'proxy_use_local_resolver' in packetbeat_combined.output.logstash %}
    # The proxy_use_local_resolver option determines if Logstash hostnames are
    # resolved locally when using a proxy. The default value is false which
    # means that when a proxy is used the name resolution occurs on the proxy
    # server.
    proxy_use_local_resolver: "{{ packetbeat_combined.output.logstash.proxy_use_local_resolver }}"
{% endif %}

{% if 'index' in packetbeat_combined.output.logstash %}
    # Optional index name. The default index name depends on the each beat.
    # For Packetbeat, the default is set to packetbeat, for Topbeat
    # top topbeat and for Filebeat to filebeat.
    index: "{{ packetbeat_combined.output.logstash.index }}"
{% endif %}

{% if 'ssl' in packetbeat_combined.output.logstash %}
    # https://www.elastic.co/guide/en/beats/filebeat/current/configuration-output-ssl.html
    # ssl:
      # certificate_authorities: ["/etc/pki/root/ca.pem"]
      # certificate: "/etc/pki/client/cert.pem"
      # key: "/etc/pki/client/cert.key"
{% endif %}

{% if 'timeout' in packetbeat_combined.output.logstash %}
    # The number of seconds to wait for responses from the Logstash server
    # before timing out.
    #
    # The default is 30 (seconds).
    timeout: {{ packetbeat_combined.output.logstash.timeout }}
{% endif %}

{% if 'max_retries' in packetbeat_combined.output.logstash %}
    # The number of times to retry publishing an event after a publishing
    # failure. After the specified number of retries, the events are
    # typically dropped. Some Beats, such as Filebeat, ignore the max_retries
    # setting and retry until all events are published.
    #
    # Set max_retries to a value less than 0 to retry until all events are published.
    #
    # The default is 3.
    max_retries: {{ packetbeat_combined.output.logstash.max_retries }}
{% endif %}

{% if 'bulk_max_size' in packetbeat_combined.output.logstash %}
    # The maximum number of events to bulk in a single Logstash request.
    #
    # The default is 2048.
    #
    # If the Beat sends single events, the events are collected into batches.
    # If the Beat publishes a large batch of events (larger than the value
    # specified by bulk_max_size), the batch is split.
    #
    # Specifying a larger batch size can improve performance by lowering the
    # overhead of sending events. However big batch sizes can also increase
    # processing times, which might result in API errors, killed connections,
    # timed-out publishing requests, and, ultimately, lower throughput.
    #
    # Setting bulk_max_size to values less than or equal to 0 disables
    # buffering in libbeat. When buffering is disabled, Beats that publish
    # single events (such as Packetbeat) send each event directly to
    # Elasticsearch. Beats that publish data in batches (such as Filebeat)
    # send events in batches based on the spooler size.
    bulk_max_size: {{ packetbeat_combined.output.logstash.bulk_max_size }}
{% endif %}

{% if 'slow_start' in packetbeat_combined.output.logstash %}
    # If enabled only a subset of events in a batch of events is transferred
    # per transaction. The number of events to be sent increases up to
    # bulk_max_size if no error is encountered. On error the number of events
    # per transaction is reduced again.
    #
    # The default is false.
    slow_start: "{{ packetbeat_combined.output.logstash.slow_start }}"
{% endif %}

{% endif %}



{% if 'file' in packetbeat_combined.output %}
  #
  #------------------------- File output -----------------------------
  #
  # https://www.elastic.co/guide/en/beats/filebeat/current/file-output.html
  file:
    # Enabled this?
    enabled: "{{ packetbeat_combined.output.file.enabled }}"

    # Path to the directory where to save the generated files. The option is mandatory.
    path: "{{ packetbeat_combined.output.file.path }}"

{% if 'filename' in packetbeat_combined.output.file %}
    # Name of the generated files. The default is `filebeat` and it generates files: `filebeat`, `filebeat.1`, `filebeat.2`, etc.
    filename: "{{ packetbeat_combined.output.file.filename }}"
{% endif %}

{% if 'rotate_every_kb' in packetbeat_combined.output.file %}
    # Maximum size in kilobytes of each file. When this size is reached, the files are
    # rotated. The default value is 10 MB.
    rotate_every_kb: {{ packetbeat_combined.output.file.rotate_every_kb }}
{% endif %}

{% if 'number_of_files' in packetbeat_combined.output.file %}
    # Maximum number of files under path. When this number of files is reached, the
    # oldest file is deleted and the rest are shifted from last to first. The default
    # is 7 files.
    number_of_files: {{ packetbeat_combined.output.file.number_of_files }}
{% endif %}
{% endif %}



{% if 'console' in packetbeat_combined.output %}
  #
  #------------------------- Console output -----------------------------
  #
  # https://www.elastic.co/guide/en/beats/filebeat/current/console-output.html
  console:
{% if 'enabled' in packetbeat_combined.output.console %}
    # The enabled config is a boolean setting to enable or disable the output.
    # If set to false, the output is disabled.
    #
    # The default value is true.
    enabled: "{{ packetbeat_combined.output.console.enabled }}"
{% endif %}

{% if 'pretty' in packetbeat_combined.output.console %}
    # If pretty is set to true, events written to stdout will be nicely formatted.
    #
    # The default is false.
    pretty: "{{ packetbeat_combined.output.console.pretty }}"
{% endif %}

{% if 'bulk_max_size' in packetbeat_combined.output.console %}
    # The maximum number of events to buffer internally during publishing.
    #
    # The default is 2048.
    #
    # Specifying a larger batch size may add some latency and buffering during
    # publishing. However, for Console output, this setting does not affect how
    # events are published.
    #
    # Setting bulk_max_size to 0 disables buffering in libbeat.
    bulk_max_size: {{ packetbeat_combined.output.console.bulk_max_size }}
{% endif %}

{% endif %}





############################# Logging #########################################
#
# https://www.elastic.co/guide/en/beats/packetbeat/current/configuration-logging.html
#

# There are three options for the log ouput: syslog, file, stderr.
# Under Windos systems, the log files are per default sent to the file output,
# under all other system per default to syslog.
{% if 'logging' in packetbeat_combined %}
logging:

  # Sets log level. The default log level is error.
  # Available log levels are: critical, error, warning, info, debug
  level: {{ packetbeat_combined.logging.level }}

  # Enable debug output for selected components. To enable all selectors use ["*"]
  # Other available selectors are beat, publish, service
  # Multiple selectors can be chained.
  selectors: {{ packetbeat_combined.logging.selectors }}

  # Send all logging output to syslog. On Windows default is false, otherwise
  # default is true.
  to_syslog: "{{ packetbeat_combined.logging.to_syslog }}"

  # Write all logging output to files. Beats automatically rotate files if rotateeverybytes
  # limit is reached.
  to_files: "{{ packetbeat_combined.logging.to_files }}"

  # To enable logging to files, to_files option has to be set to true
{% if 'files' in packetbeat_combined.logging %}
  files:
    # The directory where the log files will written to.
    path: "{{ packetbeat_combined.logging.files.path }}"

    # The name of the files where the logs are written to.
    name: "{{ packetbeat_combined.logging.files.name }}"

    # Configure log file size limit. If limit is reached, log file will be
    # automatically rotated
    rotateverybytes: {{ packetbeat_combined.logging.files.rotateeverybytes }}

    # Number of rotated log files to keep. Oldest files will be deleted first.
    keepfiles: {{ packetbeat_combined.logging.files.keepfiles }}
{% endif %}

  # Enable metrics recording
{% if 'metrics' in packetbeat_combined.logging %}
  metrics:
    enabled: "{{ packetbeat_combined.logging.metrics.enabled }}"
    period: {{ packetbeat_combined.logging.metrics.period }}
{% endif %}
{% endif %}